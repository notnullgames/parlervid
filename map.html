    <!DOCTYPE html>
    <html>
      <head>
        <meta charset="UTF-8"/>
        <title>Parler Video Locations</title>
        <meta property="og:url" content="/" />
        <meta property="og:title" content="Map of location-data embedded in Parler video uploads" />
        <meta property="og:description" content="Meta-data from videos that were uploaded to Parler. Not all the links work, as files are being deleted." />
        <meta property="og:site_name" content="parlervid" />
        <meta property="og:image" content="https://imgix.lifehacker.com.au/content/uploads/sites/4/2020/11/26/parler-hack.png" />
        <meta property="og:image:type" content="image/png" />
        <meta property="og:image:width" content="800" />
        <meta property="og:image:height" content="800" />
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="@uber">
        <meta name="twitter:creator" content="@uber">
        <meta name="twitter:title" content="Map of location-data embedded in Parler video uploads">
        <meta name="twitter:description" content="Meta-data from videos that were uploaded to Parler. Not all the links work, as files are being deleted.">
        <meta name="twitter:image" content="https://imgix.lifehacker.com.au/content/uploads/sites/4/2020/11/26/parler-hack.png" />
        <script src='https://api.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.js'></script>
        <link href='https://api.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.css' rel='stylesheet' />
        <style>
          #controls {
            font-family: sans-serif;
            position: absolute;;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255, 0.6);
            padding: 10px;
          }
        </style>
      </head>
      <body style='margin:0'>
        <div id='map' style='width: 100vw; height: 100vh;'></div>
        
        <!-- <div id="controls">
          <strong>Filters</strong><br/>
          <input type="checkbox" onchange="setUser(this.checked)" /> Has user-info<br/>
          Date: <input type="date" onchange="setStart(this.value)" value="2018-06-01" /> - <input value="2021-01-11" type="date" onchange="setEnd(this.value)"/>
        </div> -->

<script>
let user = false
let start = "2018-06-01"
let end =  "2021-01-11"

function setStart(d) {
  start = d
  updateFilter()
}

function setEnd(d) {
  end = d
  updateFilter()
}

function setUser(d) {
  user = d
  updateFilter()
}

function updateFilter() {
  console.log('update filter', { user, start, end })
}

mapboxgl.accessToken = "pk.eyJ1IjoiZGF2aWRrb25zdW1lciIsImEiOiJja2R0OHl2OXQwcGh1MnNtcGRleDRpeWRpIn0.lGkSZTG8nmxltvK6uF8NHw";

var map = new mapboxgl.Map({
  style: "mapbox://styles/davidkonsumer/ckjy9hcyn12at17pa2dyr5tch",
  center: [-95.91128797690739, 39.10422463446551],
  zoom: 3.8288679503782523,
  container: "map",
  antialias: true,
  attributionControl: false
})

map.on('click', function(e) {
  var features = map.queryRenderedFeatures(e.point, {
    layers: ['parler-drm78a']
  })

  if (!features.length) {
    return
  }

  var feature = features[0]

  var popup = new mapboxgl.Popup({ offset: [0, -15] })
    .setLngLat(feature.geometry.coordinates)
    .setHTML(`${feature.properties.id}<p>${feature.properties.time}</p>${feature.properties.displayname !== 'None' ? `<p>${feature.properties.displayname}</p>` : ''}${feature.properties.username !== 'None' ? `<p>${feature.properties.username}</p>` : ''}<video autoplay width='100%' controls onerror="videoError(this)" src="/${feature.properties.id}" />`)
    .addTo(map)
})

function videoError(vid){
  const div = document.createElement("div")
  div.className = 'error'
  div.innerHTML = "Sorry, that video is not available.<br/>We'll have to wait for the archive to be hosted somewhere." 
  vid.replaceWith(div)
}

</script>
</body>
